---
title: Skin Weights Transfer
category: rig
description: インフルエンス間でスキンウェイトを移動するツール
lang: ja
lang-ref: skin_weights_transfer
order: 125
---

## 概要

Skin Weights Transfer は、選択したコンポーネント上で、複数のソースインフルエンスから単一のターゲットインフルエンスにスキンウェイトを移動するツールです。

ソースインフルエンスのウェイトは比例配分で減算され、その分がターゲットインフルエンスに加算されます。移動量はパーセンテージまたは絶対値で指定できます。

Soft Selection に対応しており、フォールオフ領域のコンポーネントも含めて、ウェイト値に応じた量のウェイトが移動されます。

## 起動方法

専用のメニューか、以下のコマンドでツールを起動します。

```python
import faketools.tools.rig.skin_weights_transfer.ui
faketools.tools.rig.skin_weights_transfer.ui.show_ui()
```

![image001](../../images/rig/skin_weights_transfer/image001.png)


## 使用方法

ウェイトを移動するには、以下の手順を行います。

1. skinCluster が設定されたメッシュまたはコンポーネントを選択し、`SET` ボタンをクリックして skinCluster を設定します。
2. 左側の **Source (from)** リストから、ウェイトの移動元となるインフルエンスを選択します（複数選択可: Ctrl+クリック / Shift+クリック）。
3. 右側の **Target (to)** リストから、ウェイトの移動先となるインフルエンスを 1 つ選択します。
4. 対象となる頂点・CV・ラティスポイントを選択します（Soft Selection 有効時はフォールオフ領域も含まれます）。
5. **転送モード**（Percentage / Value）を選択します。
6. **Amount** スライダーで移動量を設定します。
7. 実行ボタンをクリックしてウェイトを移動します。

## オプション

### SkinCluster

操作対象の skinCluster を設定します。

- メッシュまたはコンポーネントを選択した状態で `SET` ボタンをクリックすると、選択されたオブジェクトに設定されている skinCluster が自動的に検出されます。
- 検出された skinCluster 名がフィールドに表示されます。

### インフルエンスフィルター

インフルエンスリストの表示を絞り込む機能です。

- **テキストフィルター**: スペース区切りでキーワードを入力すると、いずれかのキーワードを含むインフルエンスのみが表示されます（OR 検索）。
- **Affected Only ボタン**: オンにすると、現在選択しているコンポーネントに対してウェイトが 0 より大きいインフルエンスのみが表示されます。表示順はウェイトの合計値が大きい順にソートされます。Maya の選択を変更するとリアルタイムに更新されます。

### Source (from) リスト

ウェイトの移動元となるインフルエンスを選択します。

- 複数のインフルエンスを選択できます（Ctrl+クリック / Shift+クリック）。
- 選択中のインフルエンス数がラベルに `[N]` の形式で表示されます。
- リストで選択したインフルエンスは Maya ビューポート上でハイライト表示されます。

### Target (to) リスト

ウェイトの移動先となるインフルエンスを選択します。

- 1 つのインフルエンスのみ選択できます。
- Source と同じインフルエンスを Target に設定することはできません（Source が 1 つの場合）。

### 転送モード（Percentage / Value）

ウェイトの移動方法を選択します。

- **Percentage**: ソースインフルエンスのウェイト合計に対する割合（0〜100%）で移動量を指定します。
- **Value**: 絶対値（0.0〜1.0）で移動量を直接指定します。ソースのウェイト合計を超える場合は、ソースの合計値にクランプされます。

### Amount

転送モードに応じた移動量を指定します。

**Percentage モード（デフォルト）:**

- **100%**: ソースインフルエンスのウェイトをすべてターゲットに移動します。
- **50%**: ソースインフルエンスのウェイトの半分をターゲットに移動します。
- **0%**: ウェイトは移動されません。

**Value モード:**

- **1.0**: 最大 1.0 のウェイトをターゲットに移動します（ソースの合計を超えない範囲）。
- **0.1**: 最大 0.1 のウェイトをターゲットに移動します。

複数のソースインフルエンスが選択されている場合、各ソースのウェイトは保有比率に応じて比例配分で減算されます。

### Soft Selection 対応

Maya の Soft Selection が有効な場合、フォールオフ領域のコンポーネントも自動的に対象に含まれます。各コンポーネントの移動量は Soft Selection のウェイト値（0.0〜1.0）に応じて乗算されます。

- **ウェイト 1.0**（直接選択）: 指定した Amount がそのまま適用されます。
- **ウェイト 0.5**（フォールオフ中間）: Amount の 50% が適用されます。
- **ウェイト 0.0**（範囲外）: ウェイトは移動されません。

Soft Selection が無効の場合は、従来通りすべての選択コンポーネントに対して均等に移動が行われます。

**注意:** Affected Only フィルターは Soft Selection の影響を受けず、従来通り直接選択されたコンポーネントのみを参照します。

## ウェイト移動の仕組み

各コンポーネントに対して以下の計算が行われます。

1. すべてのソースインフルエンスのウェイト合計を算出します。
2. 転送モードに応じた移動量を算出し、Soft Selection ウェイトを乗算します。
3. 各ソースインフルエンスから、保有比率に応じてウェイトを比例配分で減算します。
4. 減算した合計分をターゲットインフルエンスに加算します。

**Percentage モードの計算式:**

```
移動量 = ソース合計 × (Amount / 100) × Soft Selection ウェイト
```

**Value モードの計算式:**

```
移動量 = min(Amount × Soft Selection ウェイト, ソース合計)
```

**例（Percentage モード）:**

- Source A のウェイト: 0.6、Source B のウェイト: 0.3、Amount: 50%、Soft Selection ウェイト: 1.0 の場合
- 移動量: (0.6 + 0.3) × 0.5 × 1.0 = 0.45
- Source A から減算: 0.45 × (0.6 / 0.9) = 0.30 → 残り 0.30
- Source B から減算: 0.45 × (0.3 / 0.9) = 0.15 → 残り 0.15
- Target に加算: +0.45

**例（Soft Selection 適用時）:**

- 同じ条件で Soft Selection ウェイトが 0.5 の場合
- 移動量: (0.6 + 0.3) × 0.5 × 0.5 = 0.225
- Source A から減算: 0.225 × (0.6 / 0.9) = 0.15 → 残り 0.45
- Source B から減算: 0.225 × (0.3 / 0.9) = 0.075 → 残り 0.225
- Target に加算: +0.225

## 対象コンポーネント

以下のコンポーネントタイプに対応しています。

- 頂点（Vertex）
- CV（Control Vertex）
- ラティスポイント（Lattice Point）

選択されたコンポーネントが skinCluster のジオメトリに属していない場合、エラーとなります。

---
title: Loft Surface Creator
category: rig
description: 複数のジョイントチェーンからロフトサーフェスを作成するツール
lang: ja
lang-ref: loft_surface_creator
order: 51
---

## 概要

複数のジョイントチェーンから NURBS サーフェスまたはメッシュをロフトで作成します。スカートやベルトなど、複数のジョイントチェーンで構成される部位のウェイト転送元を作成するのに適しています。

作成されたオブジェクトには、オプションによりスキンクラスターを自動で設定できます。

## 起動方法

専用のメニューか、以下のコマンドでツールを起動します。

```python
from faketools.tools.rig.loft_surface_creator import ui
ui.show_ui()
```

## 使用方法

### Root Joints モード

1. `Input Mode` で `Root Joints` を選択します。
2. 各ジョイントチェーンのルートジョイントを選択し、`Add Selected` ボタンで追加します。
3. オプションを設定します。
4. `Create` ボタンを押すとサーフェスまたはメッシュが作成されます。

### Direct Chains モード

1. `Input Mode` で `Direct Chains` を選択します。
2. チェーンを構成するジョイントを選択し、`Add Chain` ボタンで追加します。
3. 同じジョイント数で2つ目以降のチェーンを追加します。
4. オプションを設定します。
5. `Create` ボタンを押すとサーフェスまたはメッシュが作成されます。

## オプション

主なオプションは、以下の項目に分かれます。

* 入力モードオプション
* サーフェースオプション
* カーブオプション
* バインドオプション
* スキンケージオプション

### 入力モードオプション

* **Input Mode**
  * ジョイントの入力方法を指定します。
    * `Root Joints` : ルートジョイントを指定し、自動でジョイントチェーンを展開します。
    * `Direct Chains` : 各チェーンのジョイントを直接指定します。

* **Joints**
  * 登録されたジョイントのリストを表示します。
  * `Add Selected` / `Add Chain` : 選択したジョイントを追加します。
  * `Remove` : 選択した項目をリストから削除します。
  * `Clear` : すべての項目をクリアします。

* **Skip** (Root Joints モードのみ)
  * ジョイントチェーン内でスキップするジョイント数を指定します。
  * 例: `Skip=1` の場合、1つおきにジョイントを使用します。

### サーフェースオプション

* **Output**
  * 作成するオブジェクトの種類を指定します。
    * `NURBS Surface` : NURBSサーフェスを作成します。
    * `Mesh` : メッシュを作成します。

* **Surface Div**
  * ロフト方向（チェーン間）の追加分割数を指定します。
  * 0 の場合、追加分割なしでチェーン数に基づいた最小限の分割になります。

* **Close**
  * オンの場合、最後のチェーンと最初のチェーンを接続して閉じた形状を作成します。
  * スカートなど環状の形状を作成する際に使用します。
  * 3本以上のチェーンが必要です。

### カーブオプション

各ジョイントチェーンからカーブを作成する際のオプションです。

* **Curve Div**
  * ジョイント間に挿入する追加CVの数を指定します。
  * カーブをより滑らかにする場合に使用します。

* **Center**
  * オンの場合、カーブのCV位置を中央に調整します。

### バインドオプション

作成したオブジェクトにスキンクラスターを設定する際のオプションです。

* **Is Bind**
  * オンの場合、作成されたオブジェクトにスキンクラスターを設定します。

* **Weight Method**
  * ウェイト計算の方法を指定します。
    * `Linear` : リニア補間でウェイトを設定します。
    * `Ease` : イーズイン/アウト補間でウェイトを設定します。
    * `Step` : 最も近いジョイントに100%のウェイトを設定します。

* **Loft Weight**
  * ロフト方向（チェーン間）のウェイト分配方法を指定します。
    * `Index` : インデックスベースの線形補間。均等なCV配置に適しています。
    * `Distance` : U=0のCV列に沿った累積距離に基づく補間。CV間の距離が不均等な場合に有効です。
    * `Projection` : 点をAB線分に投影して補間係数を計算。ジオメトリの形状に基づいた自然な補間が可能です。

* **Smooth Iter**
  * ウェイトスムージングの反復回数を指定します。
  * カーブ方向（ジョイント間）のみに適用されます。

* **Parent Influence**
  * 親ジョイントへの影響比率を指定します（0.0〜1.0）。
  * 値が大きいほど親ジョイントの影響が強くなります。

* **Remove End**
  * オンの場合、末端ジョイントのウェイトを親ジョイントにマージします。
  * `Close` がオフの場合のみ有効です。

### スキンケージオプション

NURBSサーフェスをスキンケージメッシュに変換する際のオプションです。
`Output` が `NURBS Surface` かつ `Is Bind` がオンの場合のみ有効です。

* **To Skin Cage**
  * オンの場合、作成されたNURBSサーフェスをスキンケージメッシュに変換します。
  * 元のNURBSサーフェスは削除されます。

* **Cage Div Levels**
  * スキンケージの分割レベルを指定します。
  * 値が大きいほど細かいメッシュになります。

## プリセット機能

ツールウィンドウの `Presets` メニューから、現在の設定をプリセットとして保存・読み込みできます。

* **Save Preset** : 現在の設定を名前を付けて保存します。
* **Load Preset** : 保存されたプリセットを読み込みます。
* **Delete Preset** : プリセットを削除します。
* **Export Preset** : プリセットを外部ファイルにエクスポートします。
* **Import Preset** : 外部ファイルからプリセットをインポートします。

## スクリプトからの使用

```python
from faketools.tools.rig.loft_surface_creator import command

# ルートジョイントから作成
result, skin = command.create_from_root_joints(
    root_joints=["joint_A1", "joint_B1", "joint_C1"],
    close=True,
    output_type="mesh",
    is_bind=True,
)

# ジョイントチェーンを直接指定
result, skin = command.main(
    joint_chains=[
        ["joint_A1", "joint_A2", "joint_A3"],
        ["joint_B1", "joint_B2", "joint_B3"],
    ],
    output_type="nurbsSurface",
    is_bind=True,
)
```
